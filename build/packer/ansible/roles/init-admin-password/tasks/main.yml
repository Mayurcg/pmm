- name: Copy watchtower systemd service file to user-specific directory
  template:
    src: init-admin-password
    dest: /home/admin/init-admin-password
    owner: admin
    group: admin
    mode: '0755'

- name: Copy change-admin-password systemd service file to user-specific directory
  template:
    src: init-admin-password.service
    dest: /home/admin/.config/systemd/user/
    owner: admin
    group: admin
    mode: '0644'

- name: Enable and start watchtower container as a user service
  command: systemctl --user enable --now change-admin-password
  become: true
  become_user: admin
  environment:
    DBUS_SESSION_BUS_ADDRESS: "unix:path=/run/user/{{ admin_user_id.stdout }}/bus"

- name: Sleep for 1 minute
  pause:
    minutes: 1
